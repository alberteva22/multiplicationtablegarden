<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Szorzótábla Kert/ Multiplication Table Garden</title>
<meta name="author" content="Eva Valentne Dr. Albert + ChatGpt+ image from freesvg.org">

<style>
body {
    margin:0;
    font-family: Arial;
    display:flex;
    height:100vh;
width:100vw;
}

.panel{
flex:1;    
 max-width:400px;
    background:#f4f4f4;
    display:flex;
    flex-direction:column;
        padding:15px;
}

.kert {
    flex:1.2;
    position:relative;
    background:linear-gradient(to top, #6b4f2a 30%, #87CEEB 30%);
    overflow:hidden;
}

.cim{
    position:absolute;
    top:10px;
    width:100%;
    text-align:center;
    font-size:22px;
    font-weight:bold;
    color:#2d2d2d;
}

.ido{
    position:absolute;
    top:70px;
    width:100%;
    text-align:center;
    font-size:16px;
    color:#555;
}

.virag {
    position:absolute;
    height:6vh;
    width:auto;
    max-height:60px;
    min-height:30px;
    transition:0.5s;
}
.controls{ margin-top:auto; }

button {
    padding:6px;
    margin:3px 0;
    width:100%;
}

.keyboard{
    display:flex;
flex-grow:1;    
 flex-wrap:wrap;
    justify-content:space-between;
}

.keyboard button {
    width:30%;
    margin:3px;
padding:6px;
    font-size:1.1rem;
}

.feladat {
    font-size:22px;
    margin:10px 0;
}

input {
    width:100%;
    font-size:20px;
    text-align:center;
}

.uzenet{
    position:absolute;
    bottom:0;
    width:100%;
    background:#ffdddd;
    text-align:center;
    font-size:20px;
    padding:8px;
    display:none;
}
.sajatVirag {
    height:8vh;
    max-height:80px;
    min-height:40px;

    max-width:100%;
    object-fit:contain;
    display:block;
    margin:0 auto;
}</style>
</head>
<body>

<div class="panel" id="balPanel"></div>

<div class="kert" id="kert">
<div class="cim">
Szorzótábla kert/<br>
Multiplication Table Garden
</div>
<div class="ido" id="ido">⏱ 0:00</div>
<div class="uzenet" id="uzenet"></div>
</div>

<div class="panel" id="jobbPanel"></div>

<script>

/* ========= 22 VIRÁG ========= */
const viragLista = [
"virag1.svg","virag2.svg","virag3.svg","virag4.svg",
"virag5.svg","virag6.svg","virag7.svg","virag8.svg",
"virag9.svg","virag10.svg","virag11.svg","virag12.svg",
"virag13.svg","virag14.svg","virag15.svg","virag16.svg",
"virag17.svg","virag18.svg","virag19.svg","virag20.svg",
"virag21.svg","virag22.svg"
];

/* ========= VÉLETLEN KEVERÉS ========= */
function shuffle(array){
    return array.sort(()=>Math.random()-0.5);
}

const kevert = shuffle([...viragLista]);

const A_viragok = kevert.slice(0,11);
const B_viragok = kevert.slice(11,22);

/* ========= SZORZÓTÁBLA → VIRÁG TÉRKÉP ========= */
const A_tablaVirag = {};
const B_tablaVirag = {};

for(let i=0;i<=10;i++){
    A_tablaVirag[i] = A_viragok[i];
    B_tablaVirag[i] = B_viragok[i];
}

let elultetettViragok = [];
let teljesitettTablak = new Set();

/* ========= IDŐMÉRŐ ========= */
let startTime = Date.now();
setInterval(()=>{
    let diff = Math.floor((Date.now()-startTime)/1000);
    let perc = Math.floor(diff/60);
    let mp = diff%60;
    document.getElementById("ido").textContent =
        "⏱ " + perc + ":" + (mp<10?"0":"") + mp;
},1000);

/* ========= ÜZENET ========= */
function uzenet(szoveg){
    const u=document.getElementById("uzenet");
    u.textContent=szoveg;
    u.style.display="block";
    setTimeout(()=>u.style.display="none",2000);
}

function createPanel(panelId){

    const panel = document.getElementById(panelId);

    panel.innerHTML = `
        <h2>${panelId === "balPanel" ? "A csapat/ A group" : "B csapat/ B group"}</h2>
        <img class="sajatVirag">
        <div class="controls">
        <label>Szorzó tényező:/Factor: <span class="tablaSzam">0</span></label>
        <input type="range" min="0" max="10" value="0" class="slider">
        <button class="edzes">Edzés/Training</button>
        <button class="mix">Mix</button>
        <div class="feladat"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" class="valasz" readonly style="flex:1;">
            <button class="enterBtn" style="width:80px;">Enter</button>
        </div>
        <div class="keyboard"></div>
        </div>
    `;

    const slider = panel.querySelector(".slider");
    const tablaSzam = panel.querySelector(".tablaSzam");
    const feladatDiv = panel.querySelector(".feladat");
    const valaszInput = panel.querySelector(".valasz");
    const sajatVirag = panel.querySelector(".sajatVirag");
    const enterBtn = panel.querySelector(".enterBtn");

    let aktualisTabla = 0;
    let kerdesLista = [];
    let aktualisKerdes = 0;
    let helyesDb = 0;
    let mod = "edzes";

    /* ======= VIRÁG KIVÁLASZTÁS TÁBLA ALAPJÁN ======= */
    function ujViragTablaAlapjan(){
        if(panelId==="balPanel"){
            sajatVirag.src = A_tablaVirag[aktualisTabla];
        } else {
            sajatVirag.src = B_tablaVirag[aktualisTabla];
        }
        sajatVirag.dataset.fajl = sajatVirag.src;
        sajatVirag.style.filter="grayscale(100%)";
    }

    slider.oninput = () => {
        aktualisTabla = parseInt(slider.value);
        tablaSzam.textContent = aktualisTabla;
        mod="edzes";
        generalKerdesek(true);
    };

    function generalKerdesek(edzes){

        mod = edzes ? "edzes" : "mix";
        kerdesLista = [];

        if(edzes){
            for(let i=0;i<=10;i++) kerdesLista.push(i);
        } else {
            while(kerdesLista.length<3){
                let r = Math.floor(Math.random()*10);
                if(!kerdesLista.includes(r)) kerdesLista.push(r);
            }
        }

        aktualisKerdes=0;
        helyesDb=0;
        ujViragTablaAlapjan();
        kovetkezoKerdes();
    }

    function kovetkezoKerdes(){

        if(aktualisKerdes >= kerdesLista.length){

            if(mod==="edzes"){
                teljesitettTablak.add(aktualisTabla);
            }

            ultetes();
            kovetkezoTabla();
            return;
        }

        let masodik = kerdesLista[aktualisKerdes];
        feladatDiv.textContent = `${aktualisTabla} \u00B7 ${masodik} = ?`;
        valaszInput.value="";
    }

    function ellenoriz(){

        let masodik = kerdesLista[aktualisKerdes];
        let helyes = aktualisTabla * masodik;

        if(parseInt(valaszInput.value) === helyes){

            helyesDb++;

            if(mod==="edzes"){
                frissitSajatVirag(helyesDb*10);
            } else {
                frissitSajatVirag(helyesDb*33);
ontözFöldben();ontözFöldben();ontözFöldben();
                if(helyesDb===3){
                    frissitSajatVirag(100);
                }
            }
ontözFöldben();
            aktualisKerdes++;
            kovetkezoKerdes();

        } else {
            uzenet("Próbáld újra! / Try again!");
            valaszInput.value="";
        }
    }

    function frissitSajatVirag(szazalek){
        sajatVirag.style.filter = `grayscale(${100-szazalek}%)`;
    }

    function ultetes(){

        if(!sajatVirag.dataset.fajl) return;

        const img = document.createElement("img");
        img.src=sajatVirag.dataset.fajl;
        img.className="virag";
  img.dataset.szint = 0;        
img.style.filter="grayscale(100%)";

        let placed = false;
let attempts = 0;
let x, y;

while(!placed && attempts < 100){
    x = Math.random()*80 + 5;
    y = 75 + Math.random()*5;

    let overlap = false;

    for(let v of elultetettViragok){
        let dx = Math.abs(parseFloat(v.style.left) - x);
        if(dx < 8){
            overlap = true;
            break;
        }
    }

    if(!overlap){
        placed = true;
    }

    attempts++;
}

// HA nem talált helyet, akkor is tegyük le
if(!placed){
    x = Math.random()*90 + 5;
    y = 70 + Math.random()*25;
}

img.style.left = x + "%";
img.style.top = y + "%";

document.getElementById("kert").appendChild(img);
elultetettViragok.push(img);
sajatVirag.src = "";


    }

function ontözFöldben(){

        if(elultetettViragok.length===0) return;

        let index = Math.floor(Math.random()*elultetettViragok.length);
        let virag = elultetettViragok[index];

        let szint = parseInt(virag.dataset.szint);
        if(szint<100){
            szint+=10;
            virag.dataset.szint = szint;
            virag.style.filter = `grayscale(${100-szint}%)`;
        }
    }



    function kovetkezoTabla(){
        let uj = aktualisTabla+1;
        if(uj>9) uj=0;
        slider.value=uj;
        slider.dispatchEvent(new Event("input"));
    }

    panel.querySelector(".edzes").onclick=()=>generalKerdesek(true);
    panel.querySelector(".mix").onclick=()=>generalKerdesek(false);

    const keyboard = panel.querySelector(".keyboard");

    for(let i=1;i<=9;i++){
        let btn=document.createElement("button");
        btn.textContent=i;
        btn.onclick=()=>valaszInput.value+=i;
        keyboard.appendChild(btn);
    }

    let zero=document.createElement("button");
    zero.textContent="0";
    zero.onclick=()=>valaszInput.value+="0";
    keyboard.appendChild(zero);

    let torol=document.createElement("button");
    torol.textContent="Törlés/Del";
    torol.onclick=()=>valaszInput.value="";
    keyboard.appendChild(torol);

    enterBtn.onclick = ellenoriz;
}

createPanel("balPanel");
createPanel("jobbPanel");

</script>
</body>
</html>
